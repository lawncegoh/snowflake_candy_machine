{"ast":null,"code":"import { splitArgsAndCtx } from \"../context\";\nimport { EventParser } from \"../event\";\nimport { ProgramError } from \"../../error\";\nexport default class SimulateFactory {\n  static build(idlIx, txFn, idlErrors, provider, coder, programId, idl) {\n    const simulate = async (...args) => {\n      const tx = txFn(...args);\n      const [, ctx] = splitArgsAndCtx(idlIx, [...args]);\n      let resp = undefined;\n\n      try {\n        resp = await provider.simulate(tx, ctx.signers, ctx.options);\n      } catch (err) {\n        console.log(\"Translating error\", err);\n        let translatedErr = ProgramError.parse(err, idlErrors);\n\n        if (translatedErr === null) {\n          throw err;\n        }\n\n        throw translatedErr;\n      }\n\n      if (resp === undefined) {\n        throw new Error(\"Unable to simulate transaction\");\n      }\n\n      if (resp.value.err) {\n        throw new Error(`Simulate error: ${resp.value.err.toString()}`);\n      }\n\n      const logs = resp.value.logs;\n\n      if (!logs) {\n        throw new Error(\"Simulated logs not found\");\n      }\n\n      const events = [];\n\n      if (idl.events) {\n        let parser = new EventParser(programId, coder);\n        parser.parseLogs(logs, event => {\n          events.push(event);\n        });\n      }\n\n      return {\n        events,\n        raw: logs\n      };\n    };\n\n    return simulate;\n  }\n\n}","map":{"version":3,"sources":["../../../../src/program/namespace/simulate.ts"],"names":[],"mappings":"AAGA,SAAS,eAAT,QAAgC,YAAhC;AAEA,SAAS,WAAT,QAAmC,UAAnC;AAGA,SAAS,YAAT,QAA6B,aAA7B;AAEA,eAAc,MAAO,eAAP,CAAsB;AACf,SAAL,KAAK,CACjB,KADiB,EAEjB,IAFiB,EAGjB,SAHiB,EAIjB,QAJiB,EAKjB,KALiB,EAMjB,SANiB,EAOjB,GAPiB,EAOT;AAER,UAAM,QAAQ,GAAG,OAAO,GAAG,IAAV,KAAoD;AACnE,YAAM,EAAE,GAAG,IAAI,CAAC,GAAG,IAAJ,CAAf;AACA,YAAM,GAAG,GAAH,IAAU,eAAe,CAAC,KAAD,EAAQ,CAAC,GAAG,IAAJ,CAAR,CAA/B;AACA,UAAI,IAAI,GAAG,SAAX;;AACA,UAAI;AACF,QAAA,IAAI,GAAG,MAAM,QAAQ,CAAC,QAAT,CAAkB,EAAlB,EAAsB,GAAG,CAAC,OAA1B,EAAmC,GAAG,CAAC,OAAvC,CAAb;AACD,OAFD,CAEE,OAAO,GAAP,EAAY;AACZ,QAAA,OAAO,CAAC,GAAR,CAAY,mBAAZ,EAAiC,GAAjC;AACA,YAAI,aAAa,GAAG,YAAY,CAAC,KAAb,CAAmB,GAAnB,EAAwB,SAAxB,CAApB;;AACA,YAAI,aAAa,KAAK,IAAtB,EAA4B;AAC1B,gBAAM,GAAN;AACD;;AACD,cAAM,aAAN;AACD;;AACD,UAAI,IAAI,KAAK,SAAb,EAAwB;AACtB,cAAM,IAAI,KAAJ,CAAU,gCAAV,CAAN;AACD;;AACD,UAAI,IAAI,CAAC,KAAL,CAAW,GAAf,EAAoB;AAClB,cAAM,IAAI,KAAJ,CAAU,mBAAmB,IAAI,CAAC,KAAL,CAAW,GAAX,CAAe,QAAf,EAAyB,EAAtD,CAAN;AACD;;AACD,YAAM,IAAI,GAAG,IAAI,CAAC,KAAL,CAAW,IAAxB;;AACA,UAAI,CAAC,IAAL,EAAW;AACT,cAAM,IAAI,KAAJ,CAAU,0BAAV,CAAN;AACD;;AAED,YAAM,MAAM,GAAG,EAAf;;AACA,UAAI,GAAG,CAAC,MAAR,EAAgB;AACd,YAAI,MAAM,GAAG,IAAI,WAAJ,CAAgB,SAAhB,EAA2B,KAA3B,CAAb;AACA,QAAA,MAAM,CAAC,SAAP,CAAiB,IAAjB,EAAwB,KAAD,IAAU;AAC/B,UAAA,MAAM,CAAC,IAAP,CAAY,KAAZ;AACD,SAFD;AAGD;;AACD,aAAO;AAAE,QAAA,MAAF;AAAU,QAAA,GAAG,EAAE;AAAf,OAAP;AACD,KAjCD;;AAmCA,WAAO,QAAP;AACD;;AA9CiC","sourceRoot":"","sourcesContent":["import { splitArgsAndCtx } from \"../context\";\r\nimport { EventParser } from \"../event\";\r\nimport { ProgramError } from \"../../error\";\r\nexport default class SimulateFactory {\r\n    static build(idlIx, txFn, idlErrors, provider, coder, programId, idl) {\r\n        const simulate = async (...args) => {\r\n            const tx = txFn(...args);\r\n            const [, ctx] = splitArgsAndCtx(idlIx, [...args]);\r\n            let resp = undefined;\r\n            try {\r\n                resp = await provider.simulate(tx, ctx.signers, ctx.options);\r\n            }\r\n            catch (err) {\r\n                console.log(\"Translating error\", err);\r\n                let translatedErr = ProgramError.parse(err, idlErrors);\r\n                if (translatedErr === null) {\r\n                    throw err;\r\n                }\r\n                throw translatedErr;\r\n            }\r\n            if (resp === undefined) {\r\n                throw new Error(\"Unable to simulate transaction\");\r\n            }\r\n            if (resp.value.err) {\r\n                throw new Error(`Simulate error: ${resp.value.err.toString()}`);\r\n            }\r\n            const logs = resp.value.logs;\r\n            if (!logs) {\r\n                throw new Error(\"Simulated logs not found\");\r\n            }\r\n            const events = [];\r\n            if (idl.events) {\r\n                let parser = new EventParser(programId, coder);\r\n                parser.parseLogs(logs, (event) => {\r\n                    events.push(event);\r\n                });\r\n            }\r\n            return { events, raw: logs };\r\n        };\r\n        return simulate;\r\n    }\r\n}\r\n//# sourceMappingURL=simulate.js.map"]},"metadata":{},"sourceType":"module"}